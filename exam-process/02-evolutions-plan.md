# ะะปะฐะฝ ัะฒะพะปััะธะน ะฟัะพะตะบัะฐ (ะคะฐะทะฐ 2)

**ะะฐัะฐ ะฝะฐัะฐะปะฐ ัะฒะพะปััะธะน**: 2026-01-14
**ะกัะฐััั MVP**: โ ะะฐะฒะตััะตะฝ (9 ะบะพะผะผะธัะพะฒ, 10 BDD ัะตััะพะฒ, Clean Architecture)

## ะฆะตะปั ัะฒะพะปััะธะน

ะะพะดะณะพัะพะฒะธัั ะฟัะพะตะบั ะบ production deployment ั:
- **Docker ะบะพะฝัะตะนะฝะตัะธะทะฐัะธะตะน** - ะฟัะพััะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
- **ะะพะปะฝัะผ ัะตััะพะฒัะผ ะฟะพะบัััะธะตะผ** - unit + integration ัะตััั
- **ะะดะผะธะฝะธัััะฐัะธะฒะฝัะผะธ ััะฝะบัะธัะผะธ** - ัะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท ะฑะพัะฐ

## ะขัะธ ะพัะฝะพะฒะฝัะต ัะฒะพะปััะธะธ

### Evolution 1: Docker ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ๐ณ
**ะะฐัะตะผ**: ะัะพััะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต ะธ ะบะพะฝัะธะณััะฐัะธั ัะตัะตะท .env ัะฐะนะป

**ะงัะพ ะดะพะฑะฐะฒะปัะตััั**:
- `Dockerfile` ะดะปั Python 3.11 slim ะพะฑัะฐะทะฐ
- `docker-compose.yml` ั volume ะดะปั SQLite ะฟะตััะธััะตะฝัะฝะพััะธ
- `.env.example` ัะฐะฑะปะพะฝ ะดะปั ะบะพะฝัะธะณััะฐัะธะธ
- ะงัะตะฝะธะต `ADMIN_USER_ID` ะธะท environment
- `.dockerignore` ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ัะฑะพัะบะธ

### Evolution 2: ะะพะปะฝะพะต ัะตััะพะฒะพะต ะฟะพะบัััะธะต โ
**ะะฐัะตะผ**: ะฃะฑะตะดะธัััั ะฒ ะบะพััะตะบัะฝะพััะธ ะฒัะตั ัะปะพะตะฒ ะฐััะธัะตะบัััั

**ะขะตะบััะตะต ัะพััะพัะฝะธะต**: 10 BDD ัะตััะพะฒ (ัะพะปัะบะพ ะดะปั ะฑะธะทะฝะตั-ะปะพะณะธะบะธ)

**ะงัะพ ะดะพะฑะฐะฒะปัะตััั**:
- **Unit ัะตััั ะดะปั Database Layer** - CRUD ะพะฟะตัะฐัะธะธ, ััะตะผะฐ
- **Unit ัะตััั ะดะปั Service Layer** - ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ, ะฒะฐะปะธะดะฐัะธั
- **Integration ัะตััั ะดะปั Repository** - ะฟัะพะฒะตัะบะฐ ัะฐะฑะพัั ั ัะตะฐะปัะฝัะผ SQLite

### Evolution 3: ะะดะผะธะฝะธัััะฐัะธะฒะฝัะต ะบะพะผะฐะฝะดั ๐
**ะะฐัะตะผ**: ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะตัะตะณะพะฒะพัะบะฐะผะธ ะธ ะฐะดะผะธะฝะฐะผะธ ัะตัะตะท ะฑะพัะฐ

**ะงัะพ ะดะพะฑะฐะฒะปัะตััั**:
- ะขะฐะฑะปะธัะฐ `admins` ะฒ SQLite
- Admin CRUD ะผะตัะพะดั ะฒ Database/Repository/Service ัะปะพัั
- `@admin_only` ะดะตะบะพัะฐัะพั ะดะปั ะพะณัะฐะฝะธัะตะฝะธั ะดะพัััะฟะฐ
- 5 admin ะบะพะผะฐะฝะด ะฒ Telegram ะฑะพัะต
- ะะฝะธัะธะฐะปะธะทะฐัะธั ะฟะตัะฒะพะณะพ ะฐะดะผะธะฝะฐ ะธะท `.env`

---

## ะะตัะฐะปัะฝัะน ะฟะปะฐะฝ: 7 ะบะพะผะผะธัะพะฒ

### โ Commit 1: Docker + .env infrastructure

**ะกัะฐััั**: ะะฐะฒะตััะตะฝ

**ะคะฐะนะปั**:
- โ `Dockerfile`
- โ `docker-compose.yml`
- โ `.env.example`
- โ `.dockerignore`
- โ `src/bot.py` (ัะธัะฐะตั ADMIN_USER_ID)
- โ `.gitignore` (ะดะพะฑะฐะฒะปะตะฝ data/)

**ะะตะทัะปััะฐั**: ะัะพะตะบั ะผะพะถะฝะพ ะทะฐะฟัััะธัั ัะตัะตะท `docker-compose up`

---

### ๐ Commit 2: Unit tests for database layer

**ะฆะตะปั**: ะะพะบัััั `database.py` unit-ัะตััะฐะผะธ

**ะคะฐะนะปั**:
- `tests/unit/test_database.py` (ะฝะพะฒัะน)

**ะขะตััะธััะตะผัะต ััะฝะบัะธะธ**:
- `add_room()`, `get_room()`, `get_all_rooms()`
- `create_booking()`, `get_booking()`, `delete_booking()`
- `get_room_bookings()`, `get_user_bookings()`
- `find_booking_by_room_and_user()`
- `check_booking_conflict()`
- ะัะพะฒะตัะบะฐ ััะตะผั ัะฐะฑะปะธั

**ะะฐะฟััะบ**: `pytest tests/unit/test_database.py -v`

**ะะถะธะดะฐะตะผัะน coverage**: database.py ~95-100%

---

### Commit 3: Unit tests for service layer

**ะฆะตะปั**: ะะพะบัััั `service.py` unit-ัะตััะฐะผะธ

**ะคะฐะนะปั**:
- `tests/unit/test_service.py` (ะฝะพะฒัะน)

**ะขะตััะธััะตะผัะต ััะฝะบัะธะธ**:
- `list_all_rooms()`, `list_available_rooms()`
- `book_room()` ั ะฟัะพะฒะตัะบะพะน ะบะพะฝัะปะธะบัะพะฒ
- `release_room()` ั ะฟัะพะฒะตัะบะพะน ะฐะฒัะพัะธะทะฐัะธะธ
- `get_room_status()`
- `get_user_bookings()`
- ะะฐััะธะฝะณ ะฒัะตะผะตะฝะธ `_parse_time_range()`

**ะัะพะฑะตะฝะฝะพััั**: ะัะฟะพะปัะทัะตััั InMemoryRepository (ะฑัััััะต ัะตััั ะฑะตะท I/O)

**ะะฐะฟััะบ**: `pytest tests/unit/test_service.py -v`

**ะะถะธะดะฐะตะผัะน coverage**: service.py ~95%+

---

### Commit 4: Integration tests for repository

**ะฆะตะปั**: ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะดะปั `SQLiteRepository`

**ะคะฐะนะปั**:
- `tests/integration/test_repository.py` (ะฝะพะฒัะน)

**ะขะตััะธััะตะผัะต ััะตะฝะฐัะธะธ**:
- Persistence: ะดะพะฑะฐะฒะปะตะฝะธะต ะธ ะธะทะฒะปะตัะตะฝะธะต ะดะฐะฝะฝัั ะธะท ัะตะฐะปัะฝะพะณะพ SQLite
- Cascade deletion: ัะดะฐะปะตะฝะธะต room ัะดะฐะปัะตั ะฒัะต bookings
- Conflict detection ั ัะตะฐะปัะฝะพะน ะะ
- User-specific queries

**ะัะพะฑะตะฝะฝะพััั**: ะัะฟะพะปัะทัะตั ะฒัะตะผะตะฝะฝัะต ะะ (`tempfile.mkstemp`)

**ะะฐะฟััะบ**: `pytest tests/integration/test_repository.py -v`

**ะะถะธะดะฐะตะผัะน coverage**: repository.py (SQLiteRepository) ~90%+

---

### Commit 5: Admin table and repository methods

**ะฆะตะปั**: ะะพะฑะฐะฒะธัั ะธะฝััะฐััััะบัััั ะดะปั ะฐะดะผะธะฝะพะฒ (Database + Repository ัะปะพะธ)

**ะคะฐะนะปั**:
- `src/database.py` (ะพะฑะฝะพะฒะธัั: admins ัะฐะฑะปะธัะฐ + 4 ะผะตัะพะดะฐ)
- `src/repository.py` (ะพะฑะฝะพะฒะธัั: admin ะธะฝัะตััะตะนั + ัะตะฐะปะธะทะฐัะธะธ)
- `src/bot.py` (ะพะฑะฝะพะฒะธัั: ะธะฝะธัะธะฐะปะธะทะฐัะธั ะฟะตัะฒะพะณะพ ะฐะดะผะธะฝะฐ ะธะท .env)

**ะะพะฑะฐะฒะปัะตะผัะต ะผะตัะพะดั**:
```python
# Database
add_admin(user_id, username)
remove_admin(user_id)
is_admin(user_id) -> bool
get_all_admins() -> list

# Repository (abstract + SQLite + InMemory)
add_admin(user_id, username)
remove_admin(user_id)
is_admin(user_id) -> bool
get_all_admins() -> list
```

**ะกัะตะผะฐ ัะฐะฑะปะธัั admins**:
```sql
CREATE TABLE admins (
    user_id INTEGER PRIMARY KEY,
    username TEXT NOT NULL,
    added_at TEXT NOT NULL
)
```

**ะะฝะธัะธะฐะปะธะทะฐัะธั**: ะะตัะฒัะน ะฐะดะผะธะฝ ะธะท `ADMIN_USER_ID` ะดะพะฑะฐะฒะปัะตััั ะฟัะธ ััะฐััะต ะฑะพัะฐ

---

### Commit 6: Admin service layer methods with tests

**ะฆะตะปั**: ะะพะฑะฐะฒะธัั admin ะปะพะณะธะบั ะฒ Service Layer + unit ัะตััั

**ะคะฐะนะปั**:
- `src/service.py` (ะพะฑะฝะพะฒะธัั: 6 admin ะผะตัะพะดะพะฒ)
- `tests/unit/test_admin_service.py` (ะฝะพะฒัะน)

**ะะพะฑะฐะฒะปัะตะผัะต ะผะตัะพะดั ะฒ RoomBookingService**:
```python
is_admin(user_id) -> bool
add_admin(user_id, username) -> dict
remove_admin(user_id, username) -> dict
list_admins() -> list
admin_add_room(room_name, capacity) -> dict
admin_delete_room(room_name) -> dict
```

**ะขะตััั**:
- Authorization checks
- Add/remove admin ั ะฒะฐะปะธะดะฐัะธะตะน
- Add/delete room ั ะฟัะพะฒะตัะบะพะน ะดัะฑะปะธะบะฐัะพะฒ
- Business rules (ะฝะตะปัะทั ะดะพะฑะฐะฒะธัั ัััะตััะฒัััะตะณะพ ะฐะดะผะธะฝะฐ ะธ ั.ะด.)

**ะะฐะฟััะบ**: `pytest tests/unit/test_admin_service.py -v`

**ะะถะธะดะฐะตะผัะน coverage**: service.py admin methods 100%

---

### Commit 7: Admin bot commands and documentation

**ะฆะตะปั**: ะะพะฑะฐะฒะธัั ะบะพะผะฐะฝะดั ะฐะดะผะธะฝะธัััะฐัะพัะฐ ะฒ ะฑะพัะฐ + ะพะฑะฝะพะฒะธัั ะดะพะบัะผะตะฝัะฐัะธั

**ะคะฐะนะปั**:
- `src/bot.py` (ะพะฑะฝะพะฒะธัั: ะดะตะบะพัะฐัะพั + 5 ะบะพะผะฐะฝะด + ะพะฑะฝะพะฒะธัั /start)
- `README.md` (ะพะฑะฝะพะฒะธัั: Docker ะธะฝััััะบัะธะธ + Admin ะบะพะผะฐะฝะดั + Testing)
- `exam-process/02-evolutions-plan.md` (ััะพั ัะฐะนะป)
- `exam-process/README.md` (ะพะฑะฝะพะฒะธัั: ะดะพะฑะฐะฒะธัั ัะตะบัะธั ั ัะฒะพะปััะธัะผะธ)

**ะะพะฑะฐะฒะปัะตะผัะน ะดะตะบะพัะฐัะพั**:
```python
@admin_only
def handler(message):
    # ะัะพะฒะตััะตั service.is_admin(user_id)
```

**ะะพะฑะฐะฒะปัะตะผัะต ะบะพะผะฐะฝะดั**:
1. `/admin_add_room <ะฝะฐะทะฒะฐะฝะธะต> <ะฒะผะตััะธะผะพััั>` - ะดะพะฑะฐะฒะธัั ะฟะตัะตะณะพะฒะพัะบั
2. `/admin_delete_room <ะฝะฐะทะฒะฐะฝะธะต>` - ัะดะฐะปะธัั ะฟะตัะตะณะพะฒะพัะบั
3. `/admin_add` (reply to message) - ะดะพะฑะฐะฒะธัั ะฐะดะผะธะฝะฐ
4. `/admin_remove` (reply to message) - ัะดะฐะปะธัั ะฐะดะผะธะฝะฐ
5. `/admin_list` - ัะฟะธัะพะบ ะฒัะตั ะฐะดะผะธะฝะพะฒ

**ะะฑะฝะพะฒะปะตะฝะธะต /start**: ะะพะบะฐะทัะฒะฐะตั admin ะบะพะผะฐะฝะดั ัะพะปัะบะพ ะฐะดะผะธะฝะฐะผ

**ะะฑะฝะพะฒะปะตะฝะธะต README.md**:
- ะกะตะบัะธั "ะฃััะฐะฝะพะฒะบะฐ ั Docker"
- ะกะตะบัะธั "ะะดะผะธะฝะธัััะฐัะธะฒะฝัะต ะบะพะผะฐะฝะดั" ั ะฟัะธะผะตัะฐะผะธ
- ะกะตะบัะธั "ะขะตััะธัะพะฒะฐะฝะธะต" (BDD + Unit + Integration)

---

## ะัะธัะธัะตัะบะธะต ัะฐะนะปั ะฟะพ ัะฒะพะปััะธัะผ

### ะะพะฒัะต ัะฐะนะปั (9 ัะฐะนะปะพะฒ):
1. `Dockerfile` โ
2. `docker-compose.yml` โ
3. `.env.example` โ
4. `.dockerignore` โ
5. `tests/unit/test_database.py`
6. `tests/unit/test_service.py`
7. `tests/unit/test_admin_service.py`
8. `tests/integration/test_repository.py`
9. `exam-process/02-evolutions-plan.md`

### ะะฑะฝะพะฒะปะตะฝะฝัะต ัะฐะนะปั (6 ัะฐะนะปะพะฒ):
1. `.gitignore` โ
2. `src/bot.py` (3 ัะฐะทะฐ: .env, admin init, ะบะพะผะฐะฝะดั)
3. `src/database.py` (admins ัะฐะฑะปะธัะฐ)
4. `src/repository.py` (admin ะธะฝัะตััะตะนั)
5. `src/service.py` (admin ะผะตัะพะดั)
6. `README.md` (Docker + Admin + Tests)
7. `exam-process/README.md`

---

## ะัะตะผะตะฝะฝะพะน ะฟะปะฐะฝ

- โ **Commit 1** - Docker ะธะฝััะฐััััะบัััะฐ (15 ะผะธะฝ)
- ๐ **Commit 2** - Unit ัะตััั Database (20 ะผะธะฝ)
- **Commit 3** - Unit ัะตััั Service (20 ะผะธะฝ)
- **Commit 4** - Integration ัะตััั Repository (15 ะผะธะฝ)
- **Commit 5** - Admin ัะฐะฑะปะธัะฐ ะธ Repository (20 ะผะธะฝ)
- **Commit 6** - Admin Service + ัะตััั (20 ะผะธะฝ)
- **Commit 7** - Admin ะฑะพั ะบะพะผะฐะฝะดั + ะดะพะบัะผะตะฝัะฐัะธั (30 ะผะธะฝ)

**ะะฑัะตะต ะฒัะตะผั**: ~2.5 ัะฐัะฐ

---

## ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ะฟะพัะปะต ะฒัะตั ะบะพะผะผะธัะพะฒ

### ะขะตััั
```bash
# BDD ัะตััั (ะดะพะปะถะฝั ะฟัะพะดะพะปะถะฐัั ะฟัะพัะพะดะธัั)
pytest tests/steps/test_room_steps.py -v

# Unit ัะตััั
pytest tests/unit/ -v

# Integration ัะตััั
pytest tests/integration/ -v

# ะัะต ัะตััั
pytest -v
```

### Docker
```bash
# ะกะพะทะดะฐัั .env
cp .env.example .env
# ะััะตะดะฐะบัะธัะพะฒะฐัั .env ั ัะตะฐะปัะฝัะผ ัะพะบะตะฝะพะผ

# ะะฐะฟัััะธัั
docker-compose up -d

# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs -f
```

### ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ะฑะพัะฐ
- [x] ะะฑััะฝัะต ะบะพะผะฐะฝะดั ัะฐะฑะพัะฐัั (/rooms, /book, /available, etc.)
- [ ] ะะดะผะธะฝ ะฒะธะดะธั ะฐะดะผะธะฝ-ะบะพะผะฐะฝะดั ะฒ /start
- [ ] ะะต-ะฐะดะผะธะฝ ะะ ะฒะธะดะธั ะฐะดะผะธะฝ-ะบะพะผะฐะฝะดั
- [ ] /admin_add_room ะดะพะฑะฐะฒะปัะตั ะฟะตัะตะณะพะฒะพัะบั
- [ ] /admin_delete_room ัะดะฐะปัะตั ะฟะตัะตะณะพะฒะพัะบั
- [ ] /admin_add ะดะพะฑะฐะฒะปัะตั ะฐะดะผะธะฝะฐ
- [ ] /admin_remove ัะดะฐะปัะตั ะฐะดะผะธะฝะฐ
- [ ] /admin_list ะฟะพะบะฐะทัะฒะฐะตั ะฒัะตั ะฐะดะผะธะฝะพะฒ

### Git ะธััะพัะธั
```bash
git log --oneline
```

**ะะถะธะดะฐะตััั**: 16+ ะบะพะผะผะธัะพะฒ (9 MVP + 7 ัะฒะพะปััะธะน)

---

## ะัะตะธะผััะตััะฒะฐ ัะฒะพะปััะธะพะฝะฝะพะณะพ ะฟะพะดัะพะดะฐ

### 1. Docker ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **ะัะพััะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต**: `docker-compose up` ะธ ะฒัะต ัะฐะฑะพัะฐะตั
- **ะะทะพะปััะธั ะพะบััะถะตะฝะธั**: ะฝะตั ะบะพะฝัะปะธะบัะพะฒ ะทะฐะฒะธัะธะผะพััะตะน
- **Production-ready**: ะปะตะณะบะพ ะดะตะฟะปะพะธัั ะฝะฐ ะปัะฑะพะน ัะตัะฒะตั

### 2. ะะพะปะฝะพะต ัะตััะพะฒะพะต ะฟะพะบัััะธะต
- **ะฃะฒะตัะตะฝะฝะพััั ะฒ ะบะพะดะต**: ะบะฐะถะดัะน ัะปะพะน ะฟัะพัะตััะธัะพะฒะฐะฝ
- **ะัััััะน ัะตัะฐะบัะพัะธะฝะณ**: ัะตััั ะทะฐัะธัะฐัั ะพั ัะตะณัะตััะธะน
- **ะะพะบัะผะตะฝัะฐัะธั ะบะพะดะพะผ**: ัะตััั ะฟะพะบะฐะทัะฒะฐัั ะบะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั API

### 3. ะะดะผะธะฝะธัััะฐัะธะฒะฝัะต ััะฝะบัะธะธ
- **ะะธะฑะบะพััั**: ะดะพะฑะฐะฒะปััั/ัะดะฐะปััั ะฟะตัะตะณะพะฒะพัะบะธ ะฑะตะท ะบะพะดะฐ
- **ะะตะปะตะณะธัะพะฒะฐะฝะธะต**: ะผะพะถะฝะพ ะฝะฐะทะฝะฐัะฐัั ะดััะณะธั ะฐะดะผะธะฝะพะฒ
- **ะะตะทะพะฟะฐัะฝะพััั**: @admin_only ะทะฐัะธัะฐะตั ะบะพะผะฐะฝะดั

---

## ะััะธัะตะบัััะฐ ะฟะพัะปะต ัะฒะพะปััะธะน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Telegram Bot Layer              โ
โ  (bot.py + @admin_only decorator)       โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Service Layer                    โ
โ  (service.py - ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ)           โ
โ  โข Book/Release room logic              โ
โ  โข Admin authorization + room mgmt      โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ       Repository Pattern                 โ
โ  (repository.py - data access)           โ
โ  โข SQLiteRepository (production)         โ
โ  โข InMemoryRepository (tests)            โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Database Layer                   โ
โ  (database.py - SQLite operations)       โ
โ  โข Rooms, Bookings, Admins tables       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ Clean Architecture**:
- ะะฐะถะดัะน ัะปะพะน ะผะพะถะฝะพ ัะตััะธัะพะฒะฐัั ะฝะตะทะฐะฒะธัะธะผะพ
- Service Layer ะฝะต ะทะฐะฒะธัะธั ะพั Telegram (ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั CLI/Web)
- Repository Pattern ะฟะพะทะฒะพะปัะตั ะฟะพะดะผะตะฝััั ะะ (SQLite โ PostgreSQL)
- InMemoryRepository = ะฑัััััะต unit-ัะตััั ะฑะตะท I/O

---

## ะกัะฐััั ะฒัะฟะพะปะฝะตะฝะธั

- [x] **MVP ะทะฐะฒะตััะตะฝ** (9 ะบะพะผะผะธัะพะฒ, 10 BDD ัะตััะพะฒ)
- [x] **Commit 1: Docker + .env** โ
- [ ] **Commit 2: Unit tests Database** ๐
- [ ] **Commit 3: Unit tests Service**
- [ ] **Commit 4: Integration tests Repository**
- [ ] **Commit 5: Admin table + Repository**
- [ ] **Commit 6: Admin Service + tests**
- [ ] **Commit 7: Admin bot + docs**

**ะกะปะตะดัััะธะน ัะฐะณ**: ะะฐะฒะตััะธัั Commit 2 (unit ัะตััั ะดะปั database layer)
